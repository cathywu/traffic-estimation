from plot_utilities import text_to_np, file_to_np, fit

from matplotlib import pyplot
import numpy as np

# Regularization parameter for Elastic Net
mu = np.array([0.000000e-0, 1.000000e-10, 4.281332e-10, 1.832981e-09, 7.847600e-09, 3.359818e-08, 1.438450e-07, 6.158482e-07, 2.636651e-06, 1.128838e-05, 4.832930e-05, 2.069138e-04, 8.858668e-04, 3.792690e-03, 1.623777e-02, 6.951928e-02, 2.976351e-01, 1.274275e+00, 5.455595e+00, 2.335721e+01, 1.000000e+02])

util_1 = np.array([1.341929e-04, 1.341929e-04, 1.341930e-04, 1.341931e-04, 1.341931e-04, 1.341931e-04, 1.341929e-04, 1.341929e-04, 1.341929e-04, 1.341929e-04, 1.341930e-04, 1.341928e-04, 1.341924e-04, 1.339059e-04, 1.328538e-04, 1.229810e-04, 1.030954e-04, 4.691095e-05, 1.235911e-06, 4.652727e-09, 1.255278e-10])
util_2 = np.array([ 2.759383e-03, 2.759380e-03, 2.759379e-03, 2.759387e-03, 2.759380e-03, 2.759385e-03, 2.759385e-03, 2.759383e-03, 2.759376e-03, 2.759381e-03, 2.759381e-03, 2.759171e-03, 2.758791e-03, 2.755476e-03, 2.726949e-03, 2.642308e-03, 2.355062e-03, 1.320469e-03, 4.126073e-05, 5.345272e-08, 1.210643e-09])
util_3 = np.array([2.815383e-03, 2.815379e-03, 2.815378e-03, 2.815387e-03, 2.815379e-03, 2.815384e-03, 2.815384e-03, 2.815382e-03, 2.815376e-03, 2.815381e-03, 2.815380e-03, 2.815170e-03, 2.814790e-03, 2.811189e-03, 2.781627e-03, 2.688410e-03, 2.389236e-03, 1.329462e-03, 4.055009e-05, 5.029854e-08, 1.134640e-09])

L1_1 = np.array([30.54,  30.54,  30.54,  30.54,  30.54,  30.54,  30.54,  30.54,  30.54,  30.54,  30.54,  30.54,  30.54,  30.57,  30.64,  31.40,  33.29,  40.43,  62.96,  90.02, 107.08])
L1_2 = np.array([245.40, 245.40, 245.40, 245.40, 245.40, 245.40, 245.40, 245.40, 245.40, 245.40, 245.40, 245.40, 245.39, 245.54, 246.57, 250.02, 264.86, 319.99, 493.60, 722.49, 858.28])
util_mean = (util_1 + util_2 + util_3)/3

pyplot.plot(mu, util_mean, "bo", hold=False)
pyplot.grid(True)
# (xs, ys) = fit(np.log(mu), util_mean, degree=4)
# pyplot.plot(np.exp(xs), ys, 'b', hold=True)
pyplot.xscale('log')
pyplot.ylabel('Probability of sampling max support')
pyplot.xlabel('mu')
pyplot.title('Regularization parameter for elastic net')
pyplot.show()

# Regularization parameter for L1 + uniform (via random sampling)
# 50 iterations
# m = 175, n = 100 * 10, k = 0.06 * n * m
mu = text_to_np("1e-4    0.0010    0.0019    0.0036    0.0069    0.0132    0.0252    0.0481    0.0917    0.1749    0.3334")
old_errs = []
old_errs.append(text_to_np("1.0225    1.8928    0.0554    2.0689    2.6746    2.7975    5.0720    4.0084    2.5854    3.7664    4.9022"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    1.0245    0.7272    1.1989    1.3111    1.3215"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.4605    1.0006"))
old_errs.append(text_to_np("2.8035    4.5300    4.3956    6.4175    5.6084    5.7870    6.3441    5.8297    7.7075    7.0281    6.7224"))
old_errs.append(1.0e-13 * text_to_np("0.2473    0.6710    0.3391    0.4259    0.6175    0.4658    0.3498    0.5761    0.6937    0.5635    0.4049"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0724    0.0000    0.1136"))
old_errs.append(text_to_np("0.0000    0.7158    0.0000    0.2877    0.8321    0.3449    0.8005    0.4915    0.7786    0.8805    0.9804"))
old_errs.append(1.0e-12 * text_to_np("0.0838    0.0699    0.0468    0.0919    0.0534    0.0875    0.0665    0.1135    0.1276    0.1920    0.0834"))
old_errs.append(text_to_np("0.2646    0.0000    0.0000    0.3993    0.3541    0.9407    0.7524    1.0697    1.1531    1.1959    0.4957"))
old_errs.append(text_to_np("0.8326    0.0000    0.3640    0.0000    0.3869    0.5602    0.6705    0.0000    0.4938    0.9519    1.0998"))
old_errs.append(text_to_np("0.0000    0.0000    0.2902    1.6428    0.3294    0.3386    1.1730    1.4797    1.6971    1.1521    1.1741"))
old_errs.append(text_to_np("0.0000    1.7341    1.3504    1.4643    1.4188    2.2078    1.4907    2.0329    1.7157    2.3259    3.2126"))
old_errs.append(1.0e-12 *text_to_np("0.0560    0.0489    0.0272    0.0518    0.0272    0.0529    0.1009    0.0581    0.0286    0.0344    0.0369"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    2.0724    3.2754    0.5923    2.1702    3.0641    1.5724    3.7328"))
old_errs.append(1.0e-13 *text_to_np("0.2616    0.5268    0.5246    0.7123    0.4334    0.5372    0.3159    0.5532    0.8703    0.9991    0.7977"))
old_errs.append(text_to_np("0.3918    0.0000    1.3696    0.4273    0.6498    0.4510    0.7107    1.4654    1.3089    2.3743    2.0534"))
old_errs.append(text_to_np("0.7926    0.0000    1.1853    0.0000    0.0000    0.0000    1.0704    1.7868    1.0597    1.0622    0.6744"))
old_errs.append(text_to_np("0.0000    0.1673    0.0403    0.0000    0.6474    0.0000    1.3413    0.4106    1.2129    1.9100    1.6312"))
old_errs.append(text_to_np("0.0845    0.0000    0.1127    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.1678    0.1538"))
old_errs.append(text_to_np("1.5592    1.2954    3.2362    2.2018    2.0251    2.5215    2.9520    2.6751    2.1542    4.6780    2.6621"))
old_errs.append(1.0e-12 *text_to_np("0.0367    0.1736    0.0501    0.0954    0.0706    0.0625    0.0835    0.0408    0.0928    0.1335    0.0906"))
old_errs.append(text_to_np("2.6955    1.6014    2.0740    2.8881    2.9626    3.0060    2.2275    2.9462    2.4130    2.9497    3.2769"))
old_errs.append(text_to_np("2.6679    1.1097    0.1992    0.2817    2.5693    1.5801    3.0721    2.9071    3.1353    3.2868    2.9442"))
old_errs.append(1.0e-12 *text_to_np("0.0216    0.0955    0.1358    0.0647    0.0472    0.0663    0.0288    0.0927    0.0615    0.0691    0.0628"))
old_errs.append(1.0e-12 *text_to_np("0.0623    0.0417    0.2201    0.1939    0.0433    0.0523    0.0430    0.0754    0.0316    0.0740    0.0820"))
old_errs.append(1.0e-12 *text_to_np("0.0479    0.0478    0.0501    0.0632    0.0342    0.1360    0.0445    0.0507    0.0525    0.0376    0.0567"))
old_errs.append(1.0e-12 *text_to_np("0.0510    0.0342    0.0561    0.0458    0.0516    0.0224    0.0242    0.0387    0.2641    0.0569    0.0349"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.3835    0.0000"))
old_errs.append(text_to_np("1.0379    0.0000    0.0000    0.7583    0.8663    0.0000    1.9731    1.0355    1.3166    2.2850    2.0030"))
old_errs.append(text_to_np("5.6186    4.5472    4.1708    6.7227    6.0460    6.9950    7.0399    7.0673    7.4898    8.1152    6.8579"))
old_errs.append(text_to_np("0.0000    0.3353    0.0000    0.0535    0.3873    0.6478    0.0000    0.6142    0.3574    0.4523    0.4610"))
old_errs.append(text_to_np("0.0000    0.5232    0.4084    0.8138    0.7709    0.8067    0.6593    1.0247    0.7551    1.0591    1.1811"))
old_errs.append(text_to_np("1.8006    1.4815    1.0139    2.0151    1.6545    1.5033    2.5197    2.1305    2.5536    2.4676    3.4664"))
old_errs.append(1.0e-12 *text_to_np("0.0534    0.0338    0.0466    0.0549    0.1080    0.1282    0.0447    0.0311    0.0707    0.0666    0.0491"))
old_errs.append(text_to_np("0.0000    0.0000    0.8117    0.0000    1.0812    0.5809    0.9025    1.6271    1.1410    1.3888    2.3986"))
old_errs.append(1.0e-12 *text_to_np("0.0392    0.1041    0.0473    0.0643    0.1349    0.0625    0.0442    0.0319    0.0517    0.0398    0.3388"))
old_errs.append(text_to_np("0.5911    3.5338    1.4225    0.4645    4.5751    5.6130    4.0229    2.3880    2.0226    5.2161    4.9709"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    1.1849    0.9785    0.4198"))
old_errs.append( 1.0e-13 *text_to_np("0.6092    0.5217    0.4668    0.3992    0.6341    0.8250    0.8071    0.2743    0.3634    0.4735    0.6430"))
old_errs.append(1.0e-12 *text_to_np("0.0472    0.0319    0.0711    0.1321    0.0468    0.0991    0.0435    0.0590    0.0294    0.0567    0.0407"))
old_errs.append(text_to_np("0.0000    0.0000    0.4554    0.7740    2.0149    0.4802    1.7555    1.8947    1.4366    1.1447    2.7634"))
old_errs.append(text_to_np("0.2707    0.1048    0.1232    0.1772    1.4552    0.1527    1.6803    1.0663    1.8226    1.7111    1.9997"))
old_errs.append(text_to_np("0.0000    0.0000    0.0038    0.0059    0.0032    0.0000    0.0000    0.7739    0.9286    1.6904    1.5676"))
old_errs.append(text_to_np("0.0854    0.0840    0.0000    0.0733    0.0854    0.0540    0.0723    0.1533    0.6524    1.3753    1.5477"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.8122    0.6290    0.7640"))
old_errs.append(text_to_np("1.8764    2.5977    2.8837    2.1899    3.2540    3.4700    3.0575    3.0801    4.0900    4.0685    4.2598"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    2.5027    1.9701    0.0000    2.4993    2.4916"))
old_errs.append(1.0e-13 *text_to_np("0.4222    0.6266    0.6429    0.6049    0.7081    0.3004    0.5697    0.8490    0.3358    0.5975    0.4634"))
old_errs.append(text_to_np("0.0000    0.0000    0.1141    0.5814    0.9498    0.0000    0.2644    2.5211    0.5402    3.0103    1.8667"))
old_errs.append(text_to_np("4.2538    3.3682    4.0099    3.6471    2.3568    3.7993    4.1323    3.5794    4.1967    4.4878    4.3943"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.3928    0.0000    0.6823    0.7773    0.4055    1.0713    0.8034    0.3505"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.3078    0.5722    1.0363    0.3705"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.5377    2.7115    0.6236    2.6196    0.0000"))
old_errs.append(text_to_np("0.0000    0.4806    0.0000    0.0000    0.0000    1.4418    0.4775    0.0000    1.0742    0.0000    2.0038"))
old_errs.append(text_to_np("0.4998    0.0000    0.1859    1.8674    1.2044    1.2674    0.7610    2.3297    2.8239    2.8089    2.4206"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.4056    0.0000    0.0000    0.6666"))
old_errs.append(1.0e-13 *text_to_np("0.3177    0.4829    0.2484    0.3731    0.4264    0.3980    0.4828    0.8525    0.4790    0.4943    0.4048"))
old_errs.append(text_to_np("0.0000    1.1958    1.2575    1.3610    1.2865    1.4330    1.5518    1.5554    1.4955    1.7432    2.5126"))
old_errs.append(text_to_np("2.9626    2.5104    0.6932    1.2807    3.0385    3.9336    3.8378    4.6000    3.8106    3.8155    3.0854"))
old_errs.append(text_to_np("0.2014    0.2393    0.1783    0.0000    0.4383    0.0903    0.1829    0.8399    0.2914    0.2721    0.9138"))
old_errs.append(text_to_np("1.9588    1.7803    2.2343    1.6687    0.0000    2.6660    2.7656    2.5257    2.6308    2.6251    3.0610"))
old_errs.append(text_to_np("1.6787    0.1602    0.3828    0.3518    0.5758    0.0585    1.7443    2.6495    2.6542    2.9044    3.0905"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    1.9634    0.0000    0.0000"))
old_errs.append(text_to_np("0.0000    1.4770    3.3258    0.9775    1.8650    1.8382    2.7753    2.1551    3.6010    3.1962    3.4807"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    1.3876    0.0000    2.1448    1.7702    1.4470    0.0000"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0422    0.0380    0.0386    0.0437    0.0527    0.0636    0.0519"))
old_errs.append(text_to_np("0.4488    0.3783    0.8806    0.5831    0.0000    0.6527    0.7204    0.6379    0.7800    0.3340    0.7095"))
old_errs.append( 1.0e-12 * text_to_np("0.0690    0.0401    0.0496    0.0715    0.0631    0.0864    0.0398    0.0374    0.0584    0.1178    0.0922"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.3387    0.0000    1.0792    5.3073    0.3130    4.1890    4.8068    3.8771"))
old_errs.append(text_to_np("1.3214    4.2575    1.3833    4.4570    2.1879    1.3963    5.0437    3.3778    4.3465    4.0332    4.2500"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0039    0.0000    0.0030    2.0526    1.5054    1.6686    1.8430"))
old_errs.append( 1.0e-12 *text_to_np("0.0751    0.0357    0.0595    0.0368    0.0593    0.0408    0.0240    0.0680    0.0478    0.1270    0.0540"))
old_errs.append(text_to_np("0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    0.0000    1.9543    1.9780"))

old_err = np.array(old_errs)
old_err_mean = np.sum(old_err,axis=0)/np.shape(old_err)[0]

new_err = file_to_np('rs_constant_L1uniform_new_mus.txt',cols=True)
new_err_mean = np.sum(new_err,axis=0)/np.shape(new_err)[0]

b25_err = file_to_np('rs_constant_L1uniform_backoff25_mus.txt',cols=True)
b25_err_mean = np.sum(b25_err,axis=0)/np.shape(b25_err)[0]

b75_err = file_to_np('rs_constant_L1uniform_backoff75_mus.txt',cols=True)
b75_err_mean = np.sum(b75_err,axis=0)/np.shape(b75_err)[0]

pyplot.plot(mu, old_err_mean, "bo", hold=True)
pyplot.plot(mu, b75_err_mean, "go", hold=True)
pyplot.plot(mu, b25_err_mean, "ro", hold=True)
pyplot.plot(mu, new_err_mean, "ko", hold=True)

(xs, ys) = fit(np.log(mu), old_err_mean, degree=2)
pyplot.plot(np.exp(xs), ys, 'b', hold=True)
(xs, ys) = fit(np.log(mu), b75_err_mean, degree=2)
pyplot.plot(np.exp(xs), ys, 'g', hold=True)
(xs, ys) = fit(np.log(mu), b25_err_mean, degree=1)
pyplot.plot(np.exp(xs), ys, 'r', hold=True)
(xs, ys) = fit(np.log(mu), new_err_mean, degree=1)
pyplot.plot(np.exp(xs), ys, 'k', hold=True)
pyplot.grid(True)
pyplot.legend(['no update (old)','old*.75 + new*.25','old*.25 + new*.75','replace(new)'],loc='upper left')
pyplot.xscale('log')
pyplot.ylabel('L1 error')
pyplot.xlabel('mu')
pyplot.title('Uniform vs L1 prior')
pyplot.show()
